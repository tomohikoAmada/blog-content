---
title: "Alpha101 公式拆解"
date: 2026-02-22
category: "量化交易"
tags: []
draft: false
---

# Alpha101 公式拆解

## Alpha#1 公式拆解

```
rank(Ts_ArgMax(SignedPower(((returns < 0) ? stddev(returns, 20) : close), 2.), 5)) - 0.5
```

***

## 先理解每个函数

* **returns**：今日收益率 = (close\_t - close\_{t-1}) / close\_{t-1}
* **SignedPower(x, 2)**：= x² × sign(x)，即保留符号的平方
* **Ts\_ArgMax(x, 5)**：过去5天中，x值最大的那天是第几天（从1到5）
* **rank(...)**：在截面（所有股票中）做百分位排名，结果在0\~1之间

***

## 具体例子：计算某只股票的中间步骤

### 第一步：计算 returns 并判断条件

假设某股票最近几天收盘价：

| 日期 | close | returns |
| --- | ----- | ------- |
| D-6 | 100 | — |
| D-5 | 98 | **-0.020**（负） |
| D-4 | 99 | +0.010（正） |
| D-3 | 97 | **-0.020**（负） |
| D-2 | 101 | +0.041（正） |
| D-1 | 103 | +0.020（正） |

***

### 第二步：套入三元条件，得到每天的"原始值"

* **returns < 0 → 用 stddev(returns, 20)**（过去20天收益率的标准差）
* **returns ≥ 0 → 直接用 close**

假设过去20天收益率标准差 stddev = **0.018**（这个值每天都在变，这里简化为固定值）：

| 日期 | returns < 0? | 原始值 x |
| --- | ------------ | ----- |
| D-5 | ✅ 是 | 0.018（stddev） |
| D-4 | ❌ 否 | 99（close） |
| D-3 | ✅ 是 | 0.018（stddev） |
| D-2 | ❌ 否 | 101（close） |
| D-1 | ❌ 否 | 103（close） |

***

### 第三步：SignedPower(x, 2) = x² × sign(x)

由于所有 x 值都是正数，sign(x) = +1，所以 SignedPower(x,2) = x²：

| 日期 | x | SignedPower(x, 2) |
| --- | --- | ----------------- |
| D-5 | 0.018 | 0.018² = **0.000324** |
| D-4 | 99 | 99² = **9801** |
| D-3 | 0.018 | **0.000324** |
| D-2 | 101 | **10201** |
| D-1 | 103 | **10609** |

> 💡 关键观察：当 returns < 0 时，用的是小得多的 stddev，平方后非常小；当 returns ≥ 0 时，用 close（几十上百），平方后极大。所以**下跌日的值会被压得很低**。

***

### 第四步：Ts\_ArgMax(..., 5) — 找过去5天中最大值在第几天

过去5天的 SignedPower 值：

```
D-5: 0.000324
D-4: 9801
D-3: 0.000324
D-2: 10201
D-1: 10609  ← 最大值在这里，是第5天（最近一天）
```

**Ts\_ArgMax = 5**

***

### 第五步：rank(...) — 截面百分位

此时把所有股票（假设500只）都算出各自的 Ts\_ArgMax 值，然后做排名：

* 如果这只股票排在第400位 → rank = 400/500 = **0.80**
* 最终：**0.80 - 0.5 = +0.30**

***

## 再看一个对比例子：近期连续下跌的股票

假设另一只股票最近5天都是下跌，全部用 stddev：

| 日期 | SignedPower 值 |
| --- | ------------- |
| D-5 | 0.000400 |
| D-4 | 0.000361 |
| D-3 | 0.000324 |
| D-2 | 0.000289 |
| D-1 | 0.000256 ← 最小，不是最大 |

假设 ArgMax = 1（最大值在5天前），那 rank 会很低，比如 rank = 0.15，最终 = **0.15 - 0.5 = -0.35**（做空信号）。

***

## 整体逻辑总结

这个 Alpha 的核心思想是：

1. **近期有上涨且价格高** → SignedPower 大 → ArgMax 靠近今天 → rank 高 → 正值（做多）
2. **近期持续下跌** → SignedPower 压缩到极小 → ArgMax 不在近期 → rank 低 → 负值（做空）
3. **-0.5** 是为了让因子均值中性化（demean）

## Alpha#1 的交易直觉

### 一句话概括

> **"最近5天里，股价的'最强时刻'越靠近今天，就越看多；越远离今天，就越看空。"**

***

### 核心设计思路

公式里有个巧妙的"替换"：

* 股票**上涨的日子** → 用 **close**（几十到几百）
* 股票**下跌的日子** → 用 **stddev**（通常0.01\~0.03这样的小数）

平方之后，差距被放大到**天壤之别**：

* 上涨日：100² = 10000
* 下跌日：0.02² = 0.0004

这意味着，**只要某天上涨，那天的值就会压倒所有下跌日**。于是 Ts\_ArgMax 实际上就变成了——

> **"过去5天里，最后一次上涨是哪天？"**

***

### 交易直觉

| 情形 | ArgMax结果 | 信号 |
| --- | -------- | --- |
| 最近一两天上涨，之前在跌 | 靠近今天（第4、5天） | 做多 ✅ |
| 几天前上涨，近期在跌 | 远离今天（第1、2天） | 做空 ❌ |
| 近期持续上涨 | 今天（第5天） | 强做多 ✅✅ |
| 近期持续下跌 | 随机某天（都很小） | 做空 ❌ |

***

### 用大白话讲

想象你在看一个赛跑选手过去5天的状态：

* 如果他**最近两天跑得最快**，说明他在加速、状态上升 → 押注他
* 如果他**三四天前跑得最快，最近在减速**，说明势头已过 → 不押他

Alpha#1 本质上就是在捕捉这种\*\*"动能是否还在"**的感觉——不是看他跑多快，而是看**高峰是不是就在眼前\*\*。

***

### 最后的 `-0.5`

让所有股票的因子值以0为中心，正的做多、负的做空，变成一个标准的多空因子。

***

### 局限性直觉

这个因子有一个有趣的"副作用"：因为下跌日被 stddev 替换，股价绝对水平高的股票（比如贵州茅台）天然会在上涨日产生更大的值，所以**高价股会有系统性偏向**，实际使用时需要注意行业/价格中性化处理。